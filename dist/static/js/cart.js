"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var a=e[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}$(function(){var t={carts:$(".cart-center"),checkAll:$("#checkAll"),totalCount:$("#totalCount"),totalPrice:$("#totalPrice"),delCartGoods:$("#delCartGoods"),delCartGood:$("#delCartGood"),deslectionBtn:$("#deslection")};new ShowCartGoodsInfo(t)});var ShowCartGoodsInfo=function(){function e(t){_classCallCheck(this,e),this.carts=t.carts,this.checkAll=t.checkAll,this.totalCount=t.totalCount,this.totalPrice=t.totalPrice,this.delCartGoods=t.delCartGoods,this.deslectionBtn=t.deslectionBtn,this.getCartGoods(),this.getGoods()}return _createClass(e,[{key:"getCartGoods",value:function(){if(localStorage.getItem("shops")){var t=localStorage.getItem("shops"),e=JSON.parse(t);this.cartGoodsInfo=e}else this.cartGoodsInfo=null}},{key:"getGoods",value:function(){var e=this;$.getJSON("json/tianmao.json",function(t){e.goods=t,e.showCartGoodsInfo(t)})}},{key:"showCartGoodsInfo",value:function(t){if(this.cartGoodsInfo){for(var e="",o=0;o<t.length;o++)for(var a=0;a<this.cartGoodsInfo.length;a++)t[o].bid==this.cartGoodsInfo[a].bid&&(e+='\n                    <div>\n                    <div class="item2">\n                        <span>天猫超市</span>\n                        店铺:&ensp;\n                        <a href="#">天猫超市</a>\n                        <div class="jinglingtu"></div>\n                    </div>\n                    <div class="goods">\n                        <div class="goods-top">\n                            <span>超值换购活动</span>&emsp;\n                            满100\n                        </div>\n                        <div class="goods-bottom">\n                            <ul>\n                                <li>\n                                    <input type="checkbox" class="checkOne">\n                                    <input class="goodBid" type="hidden" value="'.concat(this.cartGoodsInfo[a].bid,'"/>\n                                </li>\n                                <li>\n                                    <div class="left"><img src="images/').concat(t[o].src,'" alt=""></div>\n                                    <div class="right">\n                                        <a href="#">').concat(t[o].describe,'</a>\n                                    </div>\n                                </li>\n                                <li>颜色分类： 纯酒红</li>\n                                <li class="goodPrice">￥').concat(t[o].price,'</li>\n                                <li>\n                                    <input class="del" type="button" value="-"/>\n                                    <input type="text" class="goodCount" value="').concat(this.cartGoodsInfo[a].count,'">\n                                    <input class="add" type="button" value="+"/>\n\n                                </li>\n                                <li>\n                                    <em class="goodTotalPrice">￥').concat(Number(this.cartGoodsInfo[a].count)*Number(t[o].price),'</em>\n                                    <div style="color:#444">(0.42kg)</div>\n                                </li>\n                                <li>\n                                    <a href="#">移入收藏夹</a>\n                                    <br>\n                                    <a href="#">相似宝贝</a>\n                                </li>\n                            </ul>\n                        </div>\n                    </div>\n                    </div>\n                        '));this.carts.html(e)}new SelectCart(this)}}]),e}(),SelectCart=function(){function e(t){_classCallCheck(this,e),this.goods=t.goods,this.checkAll=t.checkAll,this.carts=t.carts,this.deslectionBtn=t.deslectionBtn,this.totalCount=t.totalCount,this.totalPrice=t.totalPrice,this.delCartGoods=t.delCartGoods,this.selectAll(),this.selectOne(),this.deselection(),this.updateCart(1,".add"),this.updateCart(-1,".del"),this.deletCartGoodsInfo(),this.computeCart=new ComputeCart(this.goods)}return _createClass(e,[{key:"selectAll",value:function(){var c=this.carts.find(".checkOne"),r=this;this.checkAll.click(function(){c.prop("checked",$(this).prop("checked")),$(this).prop("disabled",!0),r.deslectionBtn.prop("checked",!1).prop("disabled",!1);for(var t=r.carts.find(".goodCount"),e=r.carts.find(".goodBid"),o=0,a=0,n=0;n<t.length;n++)r.computeCart.setBid(e.eq(n).val()),r.computeCart.setGoodCount(),r.computeCart.setGoodPrice(),o+=r.computeCart.count,a+=r.computeCart.count*r.computeCart.price;r.totalCount.html(o),r.totalPrice.html(a)})}},{key:"selectOne",value:function(){var r=this.carts.find(".checkOne"),s=this;r.click(function(){for(var t=!0,e=!1,o=0;o<r.length;o++)r.eq(o).prop("checked")?e=!0:t=!1;t?s.checkAll.prop("checked",!0).prop("disabled",!0):s.checkAll.prop("checked",!1).prop("disabled",!1),e?s.deslectionBtn.prop("checked",!1).prop("disabled",!1):s.deslectionBtn.prop("checked",!0).prop("disabled",!0);s.carts.find(".goodCount");var a=s.carts.find(".goodBid"),n=0,c=0;for(o=0;o<r.length;o++)r.eq(o).prop("checked")&&(s.computeCart.setBid(a.eq(o).val()),s.computeCart.setGoodCount(),s.computeCart.setGoodPrice(),n+=s.computeCart.count,c+=s.computeCart.count*s.computeCart.price);s.totalCount.html(n),s.totalPrice.html(c)})}},{key:"deselection",value:function(){var t=this,e=this.carts.find(".checkOne");this.deslectionBtn.click(function(){t.checkAll.prop("checked",!1).prop("disabled",!1),e.prop("checked",!1),$(this).prop("disabled",!0),t.totalCount.html(0),t.totalPrice.html(0)})}},{key:"updateCart",value:function(n,t){var c=null,r=this;this.carts.delegate(t,"click",function(){var t=$(this).parent().parent().find(".goodBid").val();r.computeCart.setBid(t),r.computeCart.setGoodCount(),r.computeCart.setGoodPrice(),r.computeCart.updateCount(n),r.computeCart.count<0?($(this).parent().parent().parent().parent().remove(),r.computeCart.delCartGood(),r.selectOne(),r.updateCart(0,".add"),r.updateCart(0,".del")):($(this).parent().parent().find(".goodCount").html(r.computeCart.count),$(this).parent().parent().find(".goodTotalPrice").html(r.computeCart.count*r.computeCart.price)),c=r.carts.find(".checkOne");for(var e=0,o=0,a=0;a<c.length;a++)c.eq(a).prop("checked")&&(e+=Number(r.carts.find(".goodCount").eq(a).html()),o+=Number(r.carts.find(".goodTotalPrice").eq(a).html()));r.totalCount.html(e),r.totalPrice.html(o),r.computeCart.setLocalstorage()})}},{key:"deletCartGoodsInfo",value:function(){var e=this,o=this.carts.find(".checkOne");this.delCartGoods.click(function(){for(var t=0;t<o.length;t++)o.eq(t).prop("checked")&&(e.computeCart.setBid(o.eq(t).parent().parent().find(".goodBid").val()),o.eq(t).parent().parent().parent().parent().parent().remove(),e.computeCart.delCartGood());e.totalCount.html(0),e.totalPrice.html(0),e.selectOne(),e.updateCart(0,".add"),e.updateCart(0,".del")})}}]),e}(),ComputeCart=function(){function e(t){_classCallCheck(this,e),this.goods=t,this.bid="",this.cartArr=null,this.count=0,this.price=0,this.getCart()}return _createClass(e,[{key:"getCart",value:function(){if(localStorage.getItem("shops")){var t=localStorage.getItem("shops");this.cartArr=JSON.parse(t)}else this.cartArr=null}},{key:"setBid",value:function(t){this.bid=t}},{key:"setGoodCount",value:function(){if(this.cartArr)for(var t=0;t<this.cartArr.length;t++)this.cartArr[t].bid==this.bid&&(this.count=Number(this.cartArr[t].count))}},{key:"setGoodPrice",value:function(){for(var t=0;t<this.goods.length;t++)this.goods[t].bid==this.bid&&(this.price=this.goods[t].price)}},{key:"updateCount",value:function(t){this.count+=t}},{key:"setLocalstorage",value:function(){for(var t=localStorage.getItem("shops"),e=JSON.parse(t),o=0;o<e.length;o++)e[o].bid==this.bid&&(e[o].count=this.count);var a=JSON.stringify(e);localStorage.setItem("shops",a)}},{key:"delCartGood",value:function(){for(var t=localStorage.getItem("shops"),e=JSON.parse(t),o=0;o<e.length;o++)if(e[o].bid==this.bid){e.splice(o,1);break}var a=JSON.stringify(e);localStorage.setItem("shops",a)}}]),e}();